<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Picker Chat</title>
<style>
body { font-family: Arial; background:#f0f0f5; padding:20px; }
h2 { text-align:center; }
#chatContainer { border:1px solid #ccc; border-radius:10px; padding:10px; max-width:500px; margin:auto; background:white; }
#messages { height:300px; overflow-y:auto; border:1px solid #ddd; padding:5px; margin-bottom:10px; background:#fafafa; }
input { width:80%; padding:8px; border-radius:5px; border:1px solid #ccc; }
button { padding:8px 12px; border:none; border-radius:5px; background:#FF3A00; color:white; cursor:pointer; }
#cuadrantes { margin-bottom:10px; }
.cuadrante-item { margin-bottom:5px; }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<h2 id="pickerTitle">Picker</h2>
<div id="cuadrantes"></div>
<div id="chatContainer">
  <div id="messages"></div>
  <input type="text" id="chatInput" placeholder="Escribe un mensaje...">
  <button onclick="sendMessage()">Enviar</button>
</div>

<script>
// Firebase config
const firebaseConfig = { 
  apiKey: "TU_API_KEY",
  authDomain: "TU_DOMINIO.firebaseapp.com",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_BUCKET.appspot.com",
  messagingSenderId: "TU_SENDER_ID",
  appId: "TU_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Obtener pickerNum de URL
const urlParams = new URLSearchParams(window.location.search);
const pickerNum = urlParams.get('pickerNum') || 1;
document.getElementById('pickerTitle').innerText = 'Picker '+pickerNum;

// Mostrar cuadrantes pasados por URL
const cuadrantesParam = urlParams.get('cuadrantes');
const cuadrantesDiv = document.getElementById('cuadrantes');
if(cuadrantesParam){
  cuadrantesParam.split(',').forEach(c=>{
    const div = document.createElement('div');
    div.className='cuadrante-item';
    div.innerText=c;
    cuadrantesDiv.appendChild(div);
  });
}

// CHAT en tiempo real
const messagesDiv = document.getElementById('messages');
db.collection('pickers_chat').doc('picker_'+pickerNum).collection('messages')
  .orderBy('timestamp')
  .onSnapshot(snapshot=>{
    messagesDiv.innerHTML='';
    snapshot.forEach(doc=>{
      const m = doc.data();
      const div = document.createElement('div');
      div.innerHTML=`<b>${m.user}:</b> ${m.text}`;
      messagesDiv.appendChild(div);
    });
    messagesDiv.scrollTop=messagesDiv.scrollHeight;
  });

// Enviar mensaje
function sendMessage(){
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if(!text) return;
  db.collection('pickers_chat').doc('picker_'+pickerNum).collection('messages').add({
    user:'Picker '+pickerNum,
    text:text,
    timestamp:firebase.firestore.FieldValue.serverTimestamp()
  });
  input.value='';
}

// Notificaciones
function notifyNewMessage(user,text){
  if(Notification.permission==='granted'){
    new Notification('Nuevo mensaje de '+user, {body:text});
  }
}
if(Notification.permission!=='granted'){
  Notification.requestPermission();
}
</script>
</body>
</html>
